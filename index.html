<!DOCTYPE html>
<html>
<head>
  <title>PDF Manipulation</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.15.0/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
  <h1>PDF Manipulation</h1>

  <h2>Merge PDFs</h2>
  <input type="file" id="mergeInput" multiple>
  <button onclick="mergePDFs()">Merge</button>

  <h2>Split PDF</h2>
  <input type="file" id="splitInput">
  <input type="number" id="splitPageNum" placeholder="Page number">
  <button onclick="splitPDF()">Split</button>

  <h2>Extract Pages</h2>
  <input type="file" id="extractInput">
  <input type="number" id="extractStartPage" placeholder="Start page">
  <input type="number" id="extractEndPage" placeholder="End page">
  <button onclick="extractPages()">Extract</button>

  <h2>Rearrange Pages</h2>
  <input type="file" id="rearrangeInput">
  <input type="text" id="rearrangeOrder" placeholder="Page order (comma-separated)">
  <button onclick="rearrangePages()">Rearrange</button>

  <h2>Create Group PDFs</h2>
  <input type="file" id="groupInput">
  <input type="number" id="groupPageSize" placeholder="Number of pages per group">
  <button onclick="createGroupPDFs()">Create</button>

  <script>
    // Function to merge multiple PDF files
    function mergePDFs() {
      const inputFiles = document.getElementById('mergeInput').files;
      const mergedPDF = await PDFLib.PDFDocument.create();

      for (const file of inputFiles) {
        const fileData = await file.arrayBuffer();
        const pdfDoc = await PDFLib.PDFDocument.load(fileData);
        const pageCount = pdfDoc.getPageCount();

        for (let pageNum = 0; pageNum < pageCount; pageNum++) {
          const [copiedPage] = await mergedPDF.copyPages(pdfDoc, [pageNum]);
          mergedPDF.addPage(copiedPage);
        }
      }

      const mergedData = await mergedPDF.save();
      downloadFile(mergedData, 'merged.pdf');
    }

    // Function to split a PDF at a specified page
    function splitPDF() {
      const inputFile = document.getElementById('splitInput').files[0];
      const splitPageNum = parseInt(document.getElementById('splitPageNum').value);

      const fileData = await inputFile.arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(fileData);

      const firstPDF = await PDFLib.PDFDocument.create();
      const secondPDF = await PDFLib.PDFDocument.create();

      const pageCount = pdfDoc.getPageCount();
      for (let pageNum = 0; pageNum < pageCount; pageNum++) {
        const [copiedPage] = await firstPDF.copyPages(pdfDoc, [pageNum]);
        if (pageNum < splitPageNum) {
          firstPDF.addPage(copiedPage);
        } else {
          secondPDF.addPage(copiedPage);
        }
      }

      const firstData = await firstPDF.save();
      const secondData = await secondPDF.save();

      downloadFile(firstData, 'first.pdf');
      downloadFile(secondData, 'second.pdf');
    }

    // Function to extract specified pages from a PDF
    function extractPages() {
      const inputFile = document.getElementById('extractInput').files[0];
      const startPage = parseInt(document.getElementById('extractStartPage').value);
      const endPage = parseInt(document.getElementById('extractEndPage').value);

      const fileData = await inputFile.arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(fileData);

      const extractedPDF = await PDFLib.PDFDocument.create();

      const pageCount = pdfDoc.getPageCount();
      for (let pageNum = startPage - 1; pageNum <= endPage - 1 && pageNum < pageCount; pageNum++) {
        const [copiedPage] = await extractedPDF.copyPages(pdfDoc, [pageNum]);
        extractedPDF.addPage(copiedPage);
      }

      const extractedData = await extractedPDF.save();
      downloadFile(extractedData, 'extracted.pdf');
    }

    // Function to rearrange pages in a PDF
    function rearrangePages() {
      const inputFile = document.getElementById('rearrangeInput').files[0];
      const pageOrder = document.getElementById('rearrangeOrder').value.split(',');

      const fileData = await inputFile.arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(fileData);

      const rearrangedPDF = await PDFLib.PDFDocument.create();

      for (const pageNum of pageOrder) {
        const intPageNum = parseInt(pageNum);
        if (intPageNum > 0 && intPageNum <= pdfDoc.getPageCount()) {
          const [copiedPage] = await rearrangedPDF.copyPages(pdfDoc, [intPageNum - 1]);
          rearrangedPDF.addPage(copiedPage);
        }
      }

      const rearrangedData = await rearrangedPDF.save();
      downloadFile(rearrangedData, 'rearranged.pdf');
    }

    // Function to create group PDFs with a specified number of pages per group
    function createGroupPDFs() {
      const inputFile = document.getElementById('groupInput').files[0];
      const pageSize = parseInt(document.getElementById('groupPageSize').value);

      const fileData = await inputFile.arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(fileData);

      const pageCount = pdfDoc.getPageCount();
      const numGroups = Math.ceil(pageCount / pageSize);

      for (let groupNum = 0; groupNum < numGroups; groupNum++) {
        const groupPDF = await PDFLib.PDFDocument.create();
        const startPage = groupNum * pageSize;
        const endPage = Math.min((groupNum + 1) * pageSize, pageCount);

        for (let pageNum = startPage; pageNum < endPage; pageNum++) {
          const [copiedPage] = await groupPDF.copyPages(pdfDoc, [pageNum]);
          groupPDF.addPage(copiedPage);
        }

        const groupData = await groupPDF.save();
        downloadFile(groupData, `group_${groupNum + 1}.pdf`);
      }
    }

    // Function to download a file
    function downloadFile(data, fileName) {
      const blob = new Blob([data], { type: 'application/pdf' });
      const link = document.createElement('a');
      link.href = window.URL.createObjectURL(blob);
      link.download = fileName;
      link.click();
    }
  </script>
</body>
</html>
